<% layout("/layouts/boilerplate") %>
    <div class="row mt-3">
        <div class="col-8 offset-3">
            <h3>
                <%=listing.title %><br>
            </h3>

            <div class="card listing-card mt-1" style="width: 40rem;">
                <div class="col-12">
                    <% if ( listing.imageUpload && listing.imageUpload.imageurl && listing.imageUpload.imageurl
                        !=="https://bunny-wp-pullzone-dt0gklpcc4.b-cdn.net/wp-content/uploads/2025/07/Evergreen-Escape-Villa-5bhk-scaled.webp"
                        ) { %>
                        <img style="width: 40rem; height: 20rem;" src="<%= listing.imageUpload.imageurl %>" class="card-img-top show-img showCard "
                            alt="<%= listing.imageUpload.imagefilename %>">
                        <% } else { %>
                            <img style="width: 40rem; height: 20rem;" src="<%= listing.image.url %>" class="card-img-top show-img showCard "
                                alt="listing image">
                            <% } %>
                </div>
                <div class="card-body ">
                     <div class="card-text mt-1">
                        <p><i>Hosted by: <%=listing.owner.username %></i><br>
                            <i>Email: <%=listing.owner.email %></i></p>
                        <p>&#8377; <%=listing.price.toLocaleString("en-IN") %></p>
                        <p><%=listing.description %></p>
                        <p><%=listing.location %></p>
                        <p><%=listing.country %></p>
                     </div>
                    <br>

                    <div class="btns">
                        <% if(currUser && currUser._id.equals(listing.owner._id)){ %>
                        <a class="col-1 offset-1" href="/listings/<%=listing._id%>/edit"
                            style="text-decoration: none; color:black; margin-right: 2rem;">
                            <button class="edit-btn">Edit</button></a>

                        <form method="post" action="/listings/<%=listing._id%>?_method=DELETE">
                            <button class="delete-btn">Delete</button>
                        </form>
                        <% } %>
                        <a class="col-3" href="/listings/<%=listing._id%>/reviews" style="text-decoration: none;">
                            <button class="review-btn"
                                style="background-color: rgba(46, 46, 216, 0.886) !important;">Leave Review</button></a>
                    </div>

                </div>

            </div>



        </div>
        <hr />
        <div class="col-8 offset-3">
            <h3 class="mt-2">Reviews</h3>
            <br>
            <div class="row">
                <% for(review of listing.reviews) { %>
                    <div class="card col-5 ms-3 mb-3">
                        <div class="card-body">
                            <h5 class="card-title">@<%= review.author.username %></h5>
                            <p class="starability-result card-text" data-rating=<%= review.rating %>></p>
                            
                            <p style="font-weight: lighter !important;" class="card-text">
                                <%= review.comment %>
                            </p>  
                        </div>
                        <% if(currUser && currUser._id.equals(review.author._id)){ %>
                        <form class="mb-2 mt-1" method="post"
                            action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                            <small><button style="background-color: black !important; color: white !important;"
                                class="delete-btn">Delete</button></small>
                        </form>
                        <% } %>
                    </div>
                    <% } %>
            </div>
        </div>

    </div>
    </div>